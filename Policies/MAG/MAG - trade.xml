<?xml version="1.0" encoding="UTF-8"?>
<exp:Export Version="3.0"
    xmlns:L7p="http://www.layer7tech.com/ws/policy"
    xmlns:exp="http://www.layer7tech.com/ws/policy/export" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <exp:References>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MAG OTP Configuration</Name>
            <Guid>ae2e93d4-1acf-4931-b01a-8f52407756d6</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>OTK Require SSL (with Client Certificate)</Name>
            <Guid>47f768f4-b478-472b-a1ee-10f4b6e76f99</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MSSO Require Registered Device - Mutual SSL</Name>
            <Guid>ce9faafc-7d76-4818-9c56-0bb9a4b68e9c</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>OTK Require OAuth 2.0 Token</Name>
            <Guid>393bcb93-82ad-4b55-8333-1119f607a560</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MAG Require OTP</Name>
            <Guid>657c23a2-7b28-454b-adbd-d7f05f1a6250</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MAG Generate OTP</Name>
            <Guid>4b406288-f7cf-4683-bd65-0a5a6c20a14d</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MAG Update OTP</Name>
            <Guid>6200d79f-0efa-462b-8d64-d2c91b97060a</Guid>
        </EncapsulatedAssertionReference>
        <IDProviderReference RefType="com.l7tech.console.policy.exporter.IdProviderReference">
            <GOID>b377ecdbcefb79db6fdfd987c0e690a2</GOID>
        </IDProviderReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>MAG Send OTP</Name>
            <Guid>f86ddb3f-5890-4514-b28e-d87c8a7d31e7</Guid>
        </EncapsulatedAssertionReference>
        <EncapsulatedAssertionReference RefType="com.l7tech.console.policy.exporter.EncapsulatedAssertionReference">
            <Name>OTK Fail with error message</Name>
            <Guid>56bd8147-3ab4-4d09-9460-8b2de02b7a9e</Guid>
        </EncapsulatedAssertionReference>
    </exp:References>
    <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
        <wsp:All wsp:Usage="Required">
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="Component version 3.0.00 installed by MAG installer version mag3.0.00"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- This API is used for generating and validating the OTP ---"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- It Requires SSL,OAuth Token, MAG Require OTP ---"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- If OTP is not there in the request, it responds with the channel for the user to choose to send the OTP ---"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- If OTP is there in the request, it validates the OTP against the DB entry and on successful validation, redirects to the requested resource ---"/>
            </L7p:CommentAssertion>
            <L7p:CustomizeErrorResponse>
                <L7p:Content stringValue="${error.msg}"/>
                <L7p:ContentType stringValue="${content-type}"/>
                <L7p:ExtraHeaders nameValuePairArray="included">
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="Cache-Control"/>
                        <L7p:Value stringValue="no-store"/>
                    </L7p:item>
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="Pragma"/>
                        <L7p:Value stringValue="no-cache"/>
                    </L7p:item>
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="x-ca-err"/>
                        <L7p:Value stringValue="0001${error.code}"/>
                    </L7p:item>
                </L7p:ExtraHeaders>
                <L7p:HttpStatus stringValue="${status}"/>
            </L7p:CustomizeErrorResponse>
            <L7p:Encapsulated>
                <L7p:EncapsulatedAssertionConfigGuid stringValue="ae2e93d4-1acf-4931-b01a-8f52407756d6"/>
                <L7p:EncapsulatedAssertionConfigName stringValue="MAG OTP Configuration"/>
            </L7p:Encapsulated>
            <L7p:Encapsulated>
                <L7p:EncapsulatedAssertionConfigGuid stringValue="47f768f4-b478-472b-a1ee-10f4b6e76f99"/>
                <L7p:EncapsulatedAssertionConfigName stringValue="OTK Require SSL (with Client Certificate)"/>
                <L7p:Parameters mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="apiPrefix"/>
                        <L7p:value stringValue=""/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="requireClientCert"/>
                        <L7p:value stringValue="false"/>
                    </L7p:entry>
                </L7p:Parameters>
            </L7p:Encapsulated>
            <L7p:Encapsulated>
                <L7p:EncapsulatedAssertionConfigGuid stringValue="ce9faafc-7d76-4818-9c56-0bb9a4b68e9c"/>
                <L7p:EncapsulatedAssertionConfigName stringValue="MSSO Require Registered Device - Mutual SSL"/>
                <L7p:Parameters mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="lookupDevice"/>
                        <L7p:value stringValue="true"/>
                    </L7p:entry>
                </L7p:Parameters>
            </L7p:Encapsulated>
            <L7p:Encapsulated>
                <L7p:EncapsulatedAssertionConfigGuid stringValue="393bcb93-82ad-4b55-8333-1119f607a560"/>
                <L7p:EncapsulatedAssertionConfigName stringValue="OTK Require OAuth 2.0 Token"/>
                <L7p:Parameters mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="cache_lifetime"/>
                        <L7p:value stringValue="30"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="given_access_token"/>
                        <L7p:value stringValue=""/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="onetime"/>
                        <L7p:value stringValue="false"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="scope_fail"/>
                        <L7p:value stringValue="false"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="scope_required"/>
                        <L7p:value stringValue=""/>
                    </L7p:entry>
                </L7p:Parameters>
            </L7p:Encapsulated>
            <L7p:CustomizeErrorResponse>
                <L7p:Content stringValue="${error.msg}"/>
                <L7p:ContentType stringValue="${content-type}"/>
                <L7p:ExtraHeaders nameValuePairArray="included">
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="Cache-Control"/>
                        <L7p:Value stringValue="no-store"/>
                    </L7p:item>
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="Pragma"/>
                        <L7p:Value stringValue="no-cache"/>
                    </L7p:item>
                    <L7p:item nameValuePair="included">
                        <L7p:Key stringValue="x-ca-err"/>
                        <L7p:Value stringValue="8000${error.code}"/>
                    </L7p:item>
                </L7p:ExtraHeaders>
                <L7p:HttpStatus stringValue="${status}"/>
            </L7p:CustomizeErrorResponse>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtzZXNzaW9uLnN1YnNjcmliZXJfaWR9"/>
                <L7p:VariableToSet stringValue="userid"/>
            </L7p:SetVariable>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- otp_type can be either 'numerical' or 'alphanumeric' --"/>
            </L7p:CommentAssertion>
            <L7p:SetVariable>
                <L7p:AssertionComment assertionComment="included">
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="possible values"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="alphanumeric, numerical"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:AssertionComment>
                <L7p:Base64Expression stringValue="JHtkZWZhdWx0T3RwVHlwZX0="/>
                <L7p:VariableToSet stringValue="otp_type"/>
            </L7p:SetVariable>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- Maximum OTP length supported is 64 character --"/>
            </L7p:CommentAssertion>
            <L7p:SetVariable>
                <L7p:AssertionComment assertionComment="included">
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="possible values"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="4 or 6 or 8"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:AssertionComment>
                <L7p:Base64Expression stringValue="JHtkZWZhdWx0T3RwTGVuZ3RofQ=="/>
                <L7p:VariableToSet stringValue="otp_length"/>
            </L7p:SetVariable>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- notificationType supported is EMAIL or SMS only --"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="!-- replace ${defaultDeliveryChannel} below to EMAIL or SMS --"/>
            </L7p:CommentAssertion>
            <L7p:SetVariable>
                <L7p:AssertionComment assertionComment="included">
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Change this value to required Delivery mode"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="If nothing specified then the default channel is used as configured in MAG OTP Configuration"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:AssertionComment>
                <L7p:Base64Expression stringValue="JHtkZWZhdWx0RGVsaXZlcnlDaGFubmVsfQ=="/>
                <L7p:VariableToSet stringValue="notificationType"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                <L7p:VariableToSet stringValue="updateDb"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="ZmFsc2U="/>
                <L7p:VariableToSet stringValue="updateOnlyRetryCount"/>
            </L7p:SetVariable>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="stock"/>
                        <L7p:VariablePrefix stringValue="stock"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="shares"/>
                        <L7p:VariablePrefix stringValue="shares"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcXVlc3RDb2RlfQ=="/>
                        <L7p:VariableToSet stringValue="requestCode"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${shares.result}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:Operator operator="LT"/>
                                    <L7p:RightValue stringValue="10000"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="657c23a2-7b28-454b-adbd-d7f05f1a6250"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="MAG Require OTP"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="notificationType"/>
                                    <L7p:value stringValue="${notificationType}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="otp"/>
                                    <L7p:value stringValue="${request.http.header.X-OTP}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="updateDb"/>
                                    <L7p:value stringValue="${updateDb}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="userid"/>
                                    <L7p:value stringValue="${userid}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                    </wsp:OneOrMore>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="OTP was successfully validated, so allow access to protected resource"/>
                    </L7p:CommentAssertion>
                    <L7p:HardcodedResponse>
                        <L7p:Base64ResponseBody stringValue="eyAgCiAgICJyZXF1ZXN0Q29kZSI6ICIke3JlcXVlc3RDb2RlfSIsCiAgICJjb25maXJtYXRpb24iOiAiMTIzNDU2NTciCn0="/>
                        <L7p:EarlyResponse booleanValue="true"/>
                        <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                    </L7p:HardcodedResponse>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// validate otp and allow access to resource"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtlcnJvci5jb2RlfQ=="/>
                        <L7p:VariableToSet stringValue="tempCode"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtzdGF0dXN9"/>
                        <L7p:VariableToSet stringValue="tempStatus"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtlcnJvci5tc2d9"/>
                        <L7p:VariableToSet stringValue="tempMsg"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${error.code}"/>
                                <L7p:Expression2 stringValue="140"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="140"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP"/>
                                <L7p:HeaderValue stringValue="required"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-CHANNEL"/>
                                <L7p:HeaderValue stringValue="EMAIL,SMS"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// 140"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${error.code}"/>
                                <L7p:Expression2 stringValue="142"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="142"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP"/>
                                <L7p:HeaderValue stringValue="invalid"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY"/>
                                <L7p:HeaderValue stringValue="${retryCount}"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:Encapsulated>
                                <L7p:EncapsulatedAssertionConfigGuid stringValue="4b406288-f7cf-4683-bd65-0a5a6c20a14d"/>
                                <L7p:EncapsulatedAssertionConfigName stringValue="MAG Generate OTP"/>
                                <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="otp_length"/>
                                    <L7p:value stringValue="${defaultOtpLength}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="otp_type"/>
                                    <L7p:value stringValue="${defaultOtpType}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="userid"/>
                                    <L7p:value stringValue="${userid}"/>
                                    </L7p:entry>
                                </L7p:Parameters>
                            </L7p:Encapsulated>
                            <L7p:Encapsulated>
                                <L7p:EncapsulatedAssertionConfigGuid stringValue="6200d79f-0efa-462b-8d64-d2c91b97060a"/>
                                <L7p:EncapsulatedAssertionConfigName stringValue="MAG Update OTP"/>
                            </L7p:Encapsulated>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${otp}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="1"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="!-- Since LDAP resolution is not supported in SolutionKit Installer, hence create a new LDAP query (with same properties as the one mentioned )here after fresh install ---"/>
                            </L7p:CommentAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="You can use any Directory Service Providers. As an example LDAP is given below for retrieving Email ID and Mobile Number of the Users"/>
                            </L7p:CommentAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:LDAPQuery>
                                    <L7p:AttrNames stringArrayValue="included">
                                    <L7p:item stringValue="mail"/>
                                    <L7p:item stringValue="mobile"/>
                                    </L7p:AttrNames>
                                    <L7p:CacheSize intValue="100"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:LdapProviderOid goidValue="b377ecdbcefb79db6fdfd987c0e690a2"/>
                                    <L7p:QueryMappings queryAttributeMappings="included">
                                    <L7p:item mapping="included">
                                    <L7p:AttributeName stringValue="mail"/>
                                    <L7p:JoinMultivalued booleanValue="false"/>

                                    <L7p:MatchingContextVariableName stringValue="email"/>
                                    </L7p:item>
                                    <L7p:item mapping="included">
                                    <L7p:AttributeName stringValue="mobile"/>
                                    <L7p:JoinMultivalued booleanValue="false"/>

                                    <L7p:MatchingContextVariableName stringValue="mobile"/>
                                    </L7p:item>
                                    </L7p:QueryMappings>
                                    <L7p:SearchFilter stringValue="uid=${userid}"/>
                                    <L7p:SearchFilterInjectionProtected booleanValue="true"/>
                                </L7p:LDAPQuery>
                                <L7p:LDAPQuery>
                                    <L7p:AttrNames stringArrayValue="included">
                                    <L7p:item stringValue="mail"/>
                                    <L7p:item stringValue="mobile"/>
                                    </L7p:AttrNames>
                                    <L7p:CacheSize intValue="100"/>
                                    <L7p:LdapProviderOid goidValue="b377ecdbcefb79db6fdfd987c0e690a2"/>
                                    <L7p:QueryMappings queryAttributeMappings="included">
                                    <L7p:item mapping="included">
                                    <L7p:AttributeName stringValue="mail"/>
                                    <L7p:JoinMultivalued booleanValue="false"/>

                                    <L7p:MatchingContextVariableName stringValue="email"/>
                                    </L7p:item>
                                    <L7p:item mapping="included">
                                    <L7p:AttributeName stringValue="mobile"/>
                                    <L7p:JoinMultivalued booleanValue="false"/>

                                    <L7p:MatchingContextVariableName stringValue="mobile"/>
                                    </L7p:item>
                                    </L7p:QueryMappings>
                                    <L7p:SearchFilter stringValue="uid=${userid}"/>
                                    <L7p:SearchFilterInjectionProtected booleanValue="true"/>
                                </L7p:LDAPQuery>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:CommentAssertion>
                                    <L7p:Comment stringValue="Else manually setting the Email and Mobile as shown below is also fine"/>
                                    </L7p:CommentAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="c2FtcGxlQGV4YW1wbGUuY29t"/>
                                    <L7p:VariableToSet stringValue="email"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="KzEtMTIzLTU1NS01NTU1"/>
                                    <L7p:VariableToSet stringValue="mobile"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                            </wsp:OneOrMore>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="!-- MAG Send OTP needs to be edited if it is required to change Email  properties ---"/>
                            </L7p:CommentAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="!--Open this Encas and Click on Send Email Alert Assertion ---"/>
                            </L7p:CommentAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="!--Add authentication values and SSL type if required ---"/>
                            </L7p:CommentAssertion>
                            <L7p:Encapsulated>
                                <L7p:EncapsulatedAssertionConfigGuid stringValue="f86ddb3f-5890-4514-b28e-d87c8a7d31e7"/>
                                <L7p:EncapsulatedAssertionConfigName stringValue="MAG Send OTP"/>
                                <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="email"/>
                                    <L7p:value stringValue="${email}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="messageBody"/>
                                    <L7p:value stringValue="The OTP for accessing the MAG API is : ${otp}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="mobile"/>
                                    <L7p:value stringValue="${mobile}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="notificationType"/>
                                    <L7p:value stringValue="${notificationType}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="otp"/>
                                    <L7p:value stringValue="${otp}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="subject"/>
                                    <L7p:value stringValue="OTP for accessing the MAG API"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="userid"/>
                                    <L7p:value stringValue="${userid}"/>
                                    </L7p:entry>
                                </L7p:Parameters>
                            </L7p:Encapsulated>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHt0ZW1wQ29kZX0="/>
                                <L7p:VariableToSet stringValue="error.code"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHt0ZW1wU3RhdHVzfQ=="/>
                                <L7p:VariableToSet stringValue="status"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHt0ZW1wTXNnfQ=="/>
                                <L7p:VariableToSet stringValue="error.msg"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// 142"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${error.code}"/>
                                <L7p:Expression2 stringValue="143"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="143"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP"/>
                                <L7p:HeaderValue stringValue="expired"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY"/>
                                <L7p:HeaderValue stringValue="${retryCount}"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// 143"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${error.code}"/>
                                <L7p:Expression2 stringValue="144"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="144"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP"/>
                                <L7p:HeaderValue stringValue="invalid"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY"/>
                                <L7p:HeaderValue stringValue="-1"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY-INTERVAL"/>
                                <L7p:HeaderValue stringValue="${max_retry_wait_seconds}"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// 144"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${error.code}"/>
                                <L7p:Expression2 stringValue="145"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="145"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP"/>
                                <L7p:HeaderValue stringValue="suspended"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY"/>
                                <L7p:HeaderValue stringValue="-1"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:AddHeader>
                                <L7p:HeaderName stringValue="X-OTP-RETRY-INTERVAL"/>
                                <L7p:HeaderValue stringValue="${remainingTime}"/>
                                <L7p:RemoveExisting booleanValue="true"/>
                                <L7p:Target target="RESPONSE"/>
                            </L7p:AddHeader>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// 145"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:TrueAssertion/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// handle error codes for headers"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <L7p:Encapsulated>
                        <L7p:EncapsulatedAssertionConfigGuid stringValue="56bd8147-3ab4-4d09-9460-8b2de02b7a9e"/>
                        <L7p:EncapsulatedAssertionConfigName stringValue="OTK Fail with error message"/>
                        <L7p:Parameters mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="apiPrefix"/>
                                <L7p:value stringValue=""/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="givenErrorCode"/>
                                <L7p:value stringValue="${error.code}"/>
                            </L7p:entry>
                        </L7p:Parameters>
                    </L7p:Encapsulated>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// fail with additional headers and regenerate otp if error.code=142"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// validate OTP and allow access to protected resource else fail"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
        </wsp:All>
    </wsp:Policy>
</exp:Export>
