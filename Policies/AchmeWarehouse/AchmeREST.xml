<?xml version="1.0" encoding="UTF-8"?>
<exp:Export Version="3.0"
    xmlns:L7p="http://www.layer7tech.com/ws/policy"
    xmlns:exp="http://www.layer7tech.com/ws/policy/export" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <exp:References/>
    <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
        <wsp:All wsp:Usage="Required">
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="Demo ACMEWarehouse REST Policy v4"/>
            </L7p:CommentAssertion>
            <L7p:CustomizeErrorResponse>
                <L7p:ExtraHeaders nameValuePairArray="included"/>
            </L7p:CustomizeErrorResponse>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                <L7p:VariableToSet stringValue="useDoubleQuotesForJSON"/>
            </L7p:SetVariable>
            <wsp:OneOrMore wsp:Usage="Required">
                <L7p:CacheLookup>
                    <L7p:CacheEntryKey stringValue="acmeWarehouseState_${gateway.cluster.hostname}"/>
                    <L7p:CacheId stringValue="acmeWarehouseState"/>
                    <L7p:ContentTypeOverride stringValue=""/>
                    <L7p:MaxEntryAgeSeconds stringValue="1000000000"/>
                    <L7p:OtherTargetMessageVariable stringValue="currentState"/>
                    <L7p:Target target="OTHER"/>
                </L7p:CacheLookup>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdGF0ZSB4bWxucz0iaHR0cDovL3dhcmVob3VzZS5hY21lLmNvbS93cyI+DQogICAgPHByb2R1Y3RzPg0KICAgICAgICA8cHJvZHVjdD4NCiAgICAgICAgICAgIDxpZD41NDExMjwvaWQ+DQogICAgICAgICAgICA8bmFtZT5oYW1tZXI8L25hbWU+DQogICAgICAgICAgICA8ZGVzY3JpcHRpb24+Y2xhdyBoYW1tZXIgODAwZzwvZGVzY3JpcHRpb24+DQogICAgICAgICAgICA8cHJpY2U+NTkuOTk8L3ByaWNlPg0KICAgICAgICAgICAgPGluU3RvY2s+dHJ1ZTwvaW5TdG9jaz4NCiAgICAgICAgPC9wcm9kdWN0Pg0KICAgICAgICA8cHJvZHVjdD4NCiAgICAgICAgICAgIDxpZD41NDExMzwvaWQ+DQogICAgICAgICAgICA8bmFtZT5kcmlsbDwvbmFtZT4NCiAgICAgICAgICAgIDxkZXNjcmlwdGlvbj5jb3JkbGVzcyBwb3J0YWJsZSBkcmlsbC4gMTZWPC9kZXNjcmlwdGlvbj4NCiAgICAgICAgICAgIDxwcmljZT4yNDkuOTk8L3ByaWNlPg0KICAgICAgICAgICAgPGluU3RvY2s+dHJ1ZTwvaW5TdG9jaz4NCiAgICAgICAgPC9wcm9kdWN0Pg0KICAgICAgICA8cHJvZHVjdD4NCiAgICAgICAgICAgIDxpZD41NDExNDwvaWQ+DQogICAgICAgICAgICA8bmFtZT5jaXJjdWxhciBzYXc8L25hbWU+DQogICAgICAgICAgICA8ZGVzY3JpcHRpb24+MTJpbiBjaXJjdWxhciBzYXcsIDEyMGhwPC9kZXNjcmlwdGlvbj4NCiAgICAgICAgICAgIDxwcmljZT41NzQuOTk8L3ByaWNlPg0KICAgICAgICAgICAgPGluU3RvY2s+dHJ1ZTwvaW5TdG9jaz4NCiAgICAgICAgPC9wcm9kdWN0Pg0KICAgICAgICA8cHJvZHVjdD4NCiAgICAgICAgICAgIDxpZD41NDExNTwvaWQ+DQogICAgICAgICAgICA8bmFtZT5qaWdzYXc8L25hbWU+DQogICAgICAgICAgICA8ZGVzY3JpcHRpb24+cm90YXRpbmcgYmV2ZWwsIDIwaHAsIDZpbiBqaWdzYXc8L2Rlc2NyaXB0aW9uPg0KICAgICAgICAgICAgPHByaWNlPjEyNC45OTwvcHJpY2U+DQogICAgICAgICAgICA8aW5TdG9jaz50cnVlPC9pblN0b2NrPg0KICAgICAgICA8L3Byb2R1Y3Q+DQogICAgPC9wcm9kdWN0cz4NCiAgICA8b3JkZXJzLz4NCjwvc3RhdGU+"/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="currentState"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Get current state"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.header.accept}"/>
                        <L7p:Expression2 stringValue="json"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:Operator operator="CONTAINS"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Operator operator="CONTAINS"/>
                                <L7p:RightValue stringValue="json"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ZmFsc2U="/>
                        <L7p:VariableToSet stringValue="responseIsXML"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Is JSON"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                        <L7p:VariableToSet stringValue="responseIsXML"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Is XML"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Determine response format"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="GET"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="GET"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/product"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/product"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/product/"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/product/"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="2.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:output indent="yes" method="xml"/>
    
    <xsl:strip-space elements="*"/>
    
    <xsl:template match="/">
        <products xmlns="http://warehouse.acme.com/ws" xmlns:xlink="http://www.w3.org/1999/xlink">
            <xsl:for-each select="/ws:state/ws:products/ws:product">
                <xsl:sort order="ascending" select="./ws:id"/>
                <xsl:element name="product">
                    <xsl:attribute name="name"><xsl:value-of select="ws:name"/></xsl:attribute>
                    <xsl:attribute name="xlink:href" namespace="http://www.w3.org/1999/xlink">./<xsl:value-of select="ws:id"/></xsl:attribute>
                </xsl:element>
            </xsl:for-each>  
        </products>
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="ListProducts_To_POX.xsl"/>
                                <L7p:XsltVersion stringValue="2.0"/>
                            </L7p:XslTransformation>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// XML response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0">

    <xsl:output method="text"/>
    
    <xsl:strip-space elements="*"/>
    
    <xsl:template match="/">{
   'products': [
      <xsl:for-each select="/ws:state/ws:products/ws:product">
      <xsl:sort select="./ws:id" order="ascending"/>{ 'name': '<xsl:value-of select="ws:name"/>', 'id': <xsl:value-of select="ws:id"/> }<xsl:if test="not(position()=last())">,</xsl:if>
      <xsl:text>
      </xsl:text>   
      </xsl:for-each>]
}
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="ListProducts_To_JSON.xsl"/>
                                <L7p:XsltVersion stringValue="1.0"/>
                            </L7p:XslTransformation>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${useDoubleQuotesForJSON}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                    <L7p:Regex stringValue="'"/>
                                    <L7p:RegexName stringValue="Replace single quotes with double quotes"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue="&quot;"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Replace single quotes with double quotes"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                                <L7p:ResponseContentType stringValue="text/json; charset=UTF-8"/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// JSON response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return XML or JSON response"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// List Products"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="GET"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="GET"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.url.path}"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item regex="included">
                                    <L7p:Pattern stringValue="/ACMEWarehouse/product/[^/]*$"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:Regex>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:CaptureVar stringValue="productID"/>
                            <L7p:OtherTargetMessageVariable stringValue="request.url.path"/>
                            <L7p:Regex stringValue="[^/]*$"/>
                            <L7p:RegexName stringValue="Get product ID"/>
                            <L7p:Replacement stringValue=""/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtwcm9kdWN0SUR9"/>
                            <L7p:VariableToSet stringValue="productID"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${productID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="GT"/>
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="can't parse product id from ${productID}"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:FalseAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Fail"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Is positive integer or fail"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="search"/>
                                <L7p:XmlMsgSrc stringValue="currentState"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:state/ns:products/ns:product[ns:id=$productID]"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="can't parse product id from ${productID}"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:FalseAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Fail"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Product ID exists in current state"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Validate product ID"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet exclude-result-prefixes="ws" version="2.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    
    <xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
    
    <xsl:strip-space elements="*"/>

    <xsl:param name="productID"/>
    
    <xsl:template match="/">
        <xsl:element name="productDetails" namespace="http://warehouse.acme.com/ws">
            <xsl:element name="productName" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:name"/></xsl:element>
            <xsl:element name="description" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:description"/></xsl:element>
            <xsl:element name="price" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:price"/></xsl:element>
            <xsl:element name="inStock" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:inStock"/></xsl:element>
        </xsl:element>
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="GetProductDetails_To_POX.xsl"/>
                                <L7p:XsltVersion stringValue="2.0"/>
                            </L7p:XslTransformation>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// XML response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="2.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:output method="text"/>
    
    <xsl:param name="productID"/>
    
    <xsl:template match="/">{
   'name': '<xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:name"/>',
   'description': '<xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:description"/>',
   'price': <xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:price"/>,
   'stocked': <xsl:value-of select="/ws:state/ws:products/ws:product[./ws:id=$productID]/ws:inStock"/>
}
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="GetProductDetails_To_JSON.xsl"/>
                                <L7p:XsltVersion stringValue="2.0"/>
                            </L7p:XslTransformation>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${useDoubleQuotesForJSON}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                    <L7p:Regex stringValue="'"/>
                                    <L7p:RegexName stringValue="Replace single quotes with double quotes"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue="&quot;"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Replace single quotes with double quotes"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                                <L7p:ResponseContentType stringValue="text/json; charset=UTF-8"/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// JSON response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return XML or JSON response"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Get Product Details"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="GET"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="GET"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/order/new"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/order/new"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/order/new/"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/order/new/"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="PG9yZGVyIHhtbG5zPSJodHRwOi8vd2FyZWhvdXNlLmFjbWUuY29tL3dzIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeGxpbms6aHJlZj0iLi4vJHtnYXRld2F5LnRpbWUubWlsbGlzfSIvPg=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// XML response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="eydvcmRlcmlkJzogJHtnYXRld2F5LnRpbWUubWlsbGlzfX0="/>
                                <L7p:ContentType stringValue="text/json; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${useDoubleQuotesForJSON}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                    <L7p:Regex stringValue="'"/>
                                    <L7p:RegexName stringValue="Replace single quotes with double quotes"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue="&quot;"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Replace single quotes with double quotes"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                                <L7p:ResponseContentType stringValue="text/json; charset=UTF-8"/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// JSON response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return XML or JSON response"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// New Order"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="PUT"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="PUT"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.url.path}"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item regex="included">
                                    <L7p:Pattern stringValue="/ACMEWarehouse/order/[^/]*$"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:Regex>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:CaptureVar stringValue="orderID"/>
                            <L7p:OtherTargetMessageVariable stringValue="request.url.path"/>
                            <L7p:Regex stringValue="[^/]*$"/>
                            <L7p:RegexName stringValue="Get order ID"/>
                            <L7p:Replacement stringValue=""/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtvcmRlcklEfQ=="/>
                            <L7p:VariableToSet stringValue="orderID"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${orderID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="GT"/>
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="can't parse order id from ${orderID}"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:FalseAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Fail"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Is positive integer or fail"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="search"/>
                                <L7p:XmlMsgSrc stringValue="currentState"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="not(/ns:state/ns:orders/ns:order[ns:orderID=$orderID])"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="unexpected content Order id ${orderID} is not valid. Get a new unique order id"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:FalseAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Fail"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Is unique"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Validate order ID"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.header.content-type}"/>
                                    <L7p:Expression2 stringValue="xml"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="xml"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:RequestXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                </L7p:RequestXpathAssertion>
                            </wsp:All>
                            <L7p:RequestXpathAssertion>
                                <L7p:VariablePrefix stringValue="productID"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:order/ns:productid"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:RequestXpathAssertion>
                            <L7p:RequestXpathAssertion>
                                <L7p:VariablePrefix stringValue="amount"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:order/ns:amount"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:RequestXpathAssertion>
                            <L7p:RequestXpathAssertion>
                                <L7p:VariablePrefix stringValue="price"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:order/ns:price"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:RequestXpathAssertion>
                            <L7p:RequestXpathAssertion>
                                <L7p:VariablePrefix stringValue="accountID"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:order/ns:accountid"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://warehouse.acme.com/ws"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:RequestXpathAssertion>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Request is XML"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.header.content-type}"/>
                                    <L7p:Expression2 stringValue="json"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="json"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">
                                    <L7p:OtherTargetMessageVariable stringValue="jsonToXML"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:RootTagString stringValue="root"/>
                                    <L7p:Target target="REQUEST"/>
                                    <L7p:Transformation transformation="JSON_to_XML"/>
                                </L7p:JsonTransformation>
                            </wsp:All>
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="productID"/>
                                <L7p:XmlMsgSrc stringValue="jsonToXML"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//*[local-name()='productid']"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="amount"/>
                                <L7p:XmlMsgSrc stringValue="jsonToXML"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//*[local-name()='amount']"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="price"/>
                                <L7p:XmlMsgSrc stringValue="jsonToXML"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//*[local-name()='price']"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue="accountID"/>
                                <L7p:XmlMsgSrc stringValue="jsonToXML"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//*[local-name()='accountid']"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Request is JSON"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:CustomizeErrorResponse>
                                <L7p:Content stringValue="Invalid content-type or message format for content-type: ${request.http.header.content-type}"/>
                                <L7p:ExtraHeaders nameValuePairArray="included"/>
                            </L7p:CustomizeErrorResponse>
                            <L7p:FalseAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Else"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Get order properties"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:DataType variableDataType="dateTime"/>
                            <L7p:DateOffsetExpression stringValue=""/>
                            <L7p:VariableToSet stringValue="now"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtub3cueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU1hYWH0="/>
                            <L7p:VariableToSet stringValue="date"/>
                        </L7p:SetVariable>
                        <L7p:XslTransformation>
                            <L7p:Direction intValue="-1"/>
                            <L7p:OtherTargetMessageVariable stringValue="currentState"/>
                            <L7p:ResourceInfo staticResourceInfo="included">
                                <L7p:Document stringValueReference="inline"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet exclude-result-prefixes="ws" version="2.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    
    <xsl:output indent="yes" method="xml"/>
    
    <xsl:strip-space elements="*"/>
    
    <xsl:param name="orderID"/>
    <xsl:param name="accountID.result"/>
    <xsl:param name="productID.result"/>
    <xsl:param name="amount.result"/>
    <xsl:param name="price.result"/>
    <xsl:param name="date"/>
    
    <xsl:template match="@*|*|processing-instruction()|comment()">
        <xsl:copy>
            <xsl:apply-templates select="*|@*|text()|processing-instruction()|comment()"/>
        </xsl:copy>
    </xsl:template>
    
    <xsl:template match="/ws:state/ws:orders">
        <xsl:copy>
            <xsl:apply-templates select="*"/>
            <order xmlns="http://warehouse.acme.com/ws">
                <orderID xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$orderID"/></orderID>
                <accountID xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$accountID.result"/></accountID>
                <productID xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$productID.result"/></productID>
                <amount xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$amount.result"/></amount>
                <price xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$price.result"/></price>
                <date xmlns="http://warehouse.acme.com/ws"><xsl:value-of select="$date"/></date>
            </order>
        </xsl:copy>
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                            </L7p:ResourceInfo>
                            <L7p:Target target="OTHER"/>
                            <L7p:TransformName stringValue="PlaceOrder_UpdateCurrentState.xsl"/>
                            <L7p:XsltVersion stringValue="2.0"/>
                        </L7p:XslTransformation>
                        <L7p:CacheStorage>
                            <L7p:CacheEntryKey stringValue="acmeWarehouseState_${gateway.cluster.hostname}"/>
                            <L7p:CacheId stringValue="acmeWarehouseState"/>
                            <L7p:MaxEntries stringValue="1"/>
                            <L7p:MaxEntryAgeSeconds stringValue="100000000"/>
                            <L7p:MaxEntrySizeBytes stringValue="100000"/>
                            <L7p:OtherTargetMessageVariable stringValue="currentState"/>
                            <L7p:Target target="OTHER"/>
                        </L7p:CacheStorage>
                        <L7p:HardcodedResponse>
                            <L7p:ResponseContentType stringValue=""/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Place order"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Place Order"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="GET"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="GET"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/order"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/order"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${request.url.path}"/>
                                <L7p:Expression2 stringValue="/ACMEWarehouse/order/"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse/order/"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.account}"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:Operator operator="GT"/>
                                    <L7p:RightValue stringValue="0"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:All wsp:Usage="Required">
                            <L7p:CustomizeErrorResponse>
                                <L7p:Content stringValue="Invalid account ID ${request.http.parameter.account}"/>
                                <L7p:ExtraHeaders nameValuePairArray="included"/>
                            </L7p:CustomizeErrorResponse>
                            <L7p:FalseAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Fail"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Validate account ID"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="2.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:output indent="yes" method="xml"/>
    
    <xsl:strip-space elements="*"/>

    <xsl:param name="request.http.parameter.account" />
    
    <xsl:template match="/">
        <xsl:element name="orders" namespace="http://warehouse.acme.com/ws">
            <xsl:for-each select="/ws:state/ws:orders/ws:order[ws:accountID=$request.http.parameter.account]">
                <xsl:sort order="ascending" select="ws:orderID"/>
                <xsl:element name="order" namespace="http://warehouse.acme.com/ws">
                    <xsl:attribute name="ref"><xsl:value-of select="./ws:orderID"/></xsl:attribute>
                    <xsl:element name="productid" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="./ws:productID"/></xsl:element>
                    <xsl:element name="amount" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="./ws:amount"/></xsl:element>
                    <xsl:element name="price" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="./ws:price"/></xsl:element>
                    <xsl:element name="accountid" namespace="http://warehouse.acme.com/ws"><xsl:value-of select="./ws:accountID"/></xsl:element>            
                </xsl:element>
            </xsl:for-each>
        </xsl:element>
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="CurrentOrders_To_POX.xsl"/>
                                <L7p:XsltVersion stringValue="2.0"/>
                            </L7p:XslTransformation>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// XML response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${responseIsXML}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtjdXJyZW50U3RhdGUubWFpbnBhcnR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="transformedState"/>
                            </L7p:SetVariable>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:ws="http://warehouse.acme.com/ws" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    
    <xsl:output method="text"/>
    
    <xsl:param name="request.http.parameter.account"/>
    
    <xsl:template match="/">
        <xsl:choose>
            <xsl:when test="/ws:state/ws:orders/ws:order[ws:accountID=$request.http.parameter.account]">{
   'orders': [
      <xsl:for-each select="/ws:state/ws:orders/ws:order[ws:accountID=$request.http.parameter.account]">
      <xsl:sort order="ascending" select="ws:orderID"/>{ 'accountid': <xsl:value-of select="./ws:accountID"/>, 'orderid': <xsl:value-of select="./ws:orderID"/>, 'productid': <xsl:value-of select="./ws:productID"/>, 'amount': <xsl:value-of select="./ws:amount"/>, 'price': <xsl:value-of select="./ws:price"/> }<xsl:if test="not(position()=last())">,</xsl:if>
      <xsl:text>              
      </xsl:text>   
      </xsl:for-each>]
}
            </xsl:when>
        </xsl:choose>
 </xsl:template>

</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue="CurrentOrders_To_JSON.xsl"/>
                                <L7p:XsltVersion stringValue="1.0"/>
                            </L7p:XslTransformation>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${useDoubleQuotesForJSON}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="transformedState"/>
                                    <L7p:Regex stringValue="'"/>
                                    <L7p:RegexName stringValue="Replace single quotes with double quotes"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue="&quot;"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Replace single quotes with double quotes"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${transformedState.mainpart}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHt0cmFuc2Zvcm1lZFN0YXRlLm1haW5wYXJ0fQ=="/>
                                    <L7p:ResponseContentType stringValue="text/json; charset=UTF-8"/>
                                    </L7p:HardcodedResponse>
                                </wsp:All>
                                <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="bm8gY3VycmVudCBvcmRlcnMgZm9yICR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hY2NvdW50fQ=="/>
                                    <L7p:ResponseContentType stringValue=""/>
                                    <L7p:ResponseStatus stringValue="404"/>
                                </L7p:HardcodedResponse>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// JSON response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return XML or JSON response"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Current Orders"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="GET"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="GET"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.url.path}"/>
                            <L7p:Expression2 stringValue="/ACMEWarehouse"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/ACMEWarehouse"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.url.query}"/>
                            <L7p:Expression2 stringValue="wadl"/>
                            <L7p:ExpressionIsVariable booleanValue="false"/>
                            <L7p:Operator operator="CONTAINS"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="wadl"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.base}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmJhc2V9"/>
                                    <L7p:VariableToSet stringValue="base"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="QUNNRVdhcmVob3VzZQ=="/>
                                <L7p:VariableToSet stringValue="base"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Set base URI"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPGFwcGxpY2F0aW9uIHhtbG5zPSJodHRwOi8vd2FkbC5kZXYuamF2YS5uZXQvMjAwOS8wMiI+CiAgIDxkb2MgeG1sOmxhbmc9ImVuIiB0aXRsZT0iV2FyZWhvdXNlIFJFU1QiLz4KICAgPHJlc291cmNlcyBiYXNlPSIke3JlcXVlc3QudXJsLnByb3RvY29sfTovLyR7cmVxdWVzdC51cmwuaG9zdH06JHtyZXF1ZXN0LnVybC5wb3J0fS8ke2Jhc2V9Ij4KICAgICAgPHJlc291cmNlIHBhdGg9InByb2R1Y3QiIGlkPSJMaXN0IFByb2R1Y3RzIj4KICAgICAgICAgPGRvYyB4bWw6bGFuZz0iZW4iIHRpdGxlPSJMaXN0IFByb2R1Y3RzIi8+CiAgICAgICAgIDxtZXRob2QgbmFtZT0iR0VUIiBpZD0iR2V0IFByb2R1Y3QgTGlzdCI+CiAgICAgICAgICAgIDxkb2MgeG1sOmxhbmc9ImVuIiB0aXRsZT0iR2V0IFByb2R1Y3QgTGlzdCIvPgogICAgICAgICAgICA8cmVxdWVzdC8+CiAgICAgICAgIDwvbWV0aG9kPgogICAgICA8L3Jlc291cmNlPgogICAgICA8cmVzb3VyY2UgcGF0aD0icHJvZHVjdC97aWR9IiBpZD0iR2V0IFByb2R1Y3QgRGV0YWlscyI+CiAgICAgICAgIDxkb2MgeG1sOmxhbmc9ImVuIiB0aXRsZT0iR2V0IFByb2R1Y3QgRGV0YWlscyIvPgogICAgICAgICA8bWV0aG9kIG5hbWU9IkdFVCIgaWQ9IkdldCBQcm9kdWN0IERldGFpbHMiPgogICAgICAgICAgICA8ZG9jIHhtbDpsYW5nPSJlbiIgdGl0bGU9IkdldCBQcm9kdWN0IERldGFpbHMiLz4KICAgICAgICAgICAgPHJlcXVlc3Q+CiAgICAgICAgICAgICAgIDxwYXJhbSBuYW1lPSJpZCIgZGVmYXVsdD0iNTQxMTIiIHR5cGU9InhzOnN0cmluZyIgcmVxdWlyZWQ9InRydWUiIHN0eWxlPSJ0ZW1wbGF0ZSIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIi8+CiAgICAgICAgICAgIDwvcmVxdWVzdD4KICAgICAgICAgPC9tZXRob2Q+CiAgICAgIDwvcmVzb3VyY2U+CiAgICAgIDxyZXNvdXJjZSBwYXRoPSJvcmRlci9uZXciIGlkPSJOZXcgT3JkZXIiPgogICAgICAgICA8ZG9jIHhtbDpsYW5nPSJlbiIgdGl0bGU9Ik5ldyBPcmRlciIvPgogICAgICAgICA8bWV0aG9kIG5hbWU9IkdFVCIgaWQ9IkdldCBOZXcgT3JkZXIiPgogICAgICAgICAgICA8ZG9jIHhtbDpsYW5nPSJlbiIgdGl0bGU9IkdldCBOZXcgT3JkZXIiLz4KICAgICAgICAgICAgPHJlcXVlc3QvPgogICAgICAgICA8L21ldGhvZD4KICAgICAgPC9yZXNvdXJjZT4KICAgICAgPHJlc291cmNlIHBhdGg9Im9yZGVyL3tpZH0iIGlkPSJQbGFjZSBPcmRlciI+CiAgICAgICAgIDxkb2MgeG1sOmxhbmc9ImVuIiB0aXRsZT0iUGxhY2UgT3JkZXIiLz4KICAgICAgICAgPG1ldGhvZCBuYW1lPSJQVVQiIGlkPSJQdXQgUGxhY2UgT3JkZXIiPgogICAgICAgICAgICA8ZG9jIHhtbDpsYW5nPSJlbiIgdGl0bGU9IlB1dCBQbGFjZSBPcmRlciIvPgogICAgICAgICAgICA8cmVxdWVzdD4KICAgICAgICAgICAgICAgPHBhcmFtIG5hbWU9ImlkIiBkZWZhdWx0PSIxIiB0eXBlPSJ4czpzdHJpbmciIHJlcXVpcmVkPSJ0cnVlIiBzdHlsZT0idGVtcGxhdGUiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIvPgogICAgICAgICAgICAgICA8cGFyYW0gbmFtZT0iU2FtcGxlWG1sTWVzc2FnZSIgZGVmYXVsdD0iJmx0O29yZGVyIHhtbG5zPSZxdW90O2h0dHA6Ly93YXJlaG91c2UuYWNtZS5jb20vd3MmcXVvdDs+Jmx0O3Byb2R1Y3RpZD41NDExMiZsdDsvcHJvZHVjdGlkPiZsdDthbW91bnQ+NSZsdDsvYW1vdW50PiZsdDtwcmljZT4yOTkuOTUmbHQ7L3ByaWNlPiZsdDthY2NvdW50aWQ+MTIzNDU2Jmx0Oy9hY2NvdW50aWQ+Jmx0Oy9vcmRlcj4iIHR5cGU9InhzOnN0cmluZyIgcmVxdWlyZWQ9ImZhbHNlIiBzdHlsZT0icGxhaW4iIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIvPgogICAgICAgICAgICAgICA8cGFyYW0gbmFtZT0iU2FtcGxlSnNvbk1lc3NhZ2UiIGRlZmF1bHQ9InsgJ2FjY291bnRpZCc6IDEyMzQ1NiwgJ3Byb2R1Y3RpZCc6IDU0MTEyLCAnYW1vdW50JzogNSwgJ3ByaWNlJzogMjk5Ljk1IH0iIHR5cGU9InhzOnN0cmluZyIgcmVxdWlyZWQ9ImZhbHNlIiBzdHlsZT0icGxhaW4iIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIvPgogICAgICAgICAgICAgICA8cmVwcmVzZW50YXRpb24gbWVkaWFUeXBlPSJ0ZXh0L3htbDtjaGFyc2V0PVVURi04IiBlbGVtZW50PSJkYXRhIi8+CiAgICAgICAgICAgICAgIDxyZXByZXNlbnRhdGlvbiBtZWRpYVR5cGU9InRleHQvanNvbjtjaGFyc2V0PVVURi04IiBlbGVtZW50PSJkYXRhIi8+CiAgICAgICAgICAgIDwvcmVxdWVzdD4KICAgICAgICAgPC9tZXRob2Q+CiAgICAgIDwvcmVzb3VyY2U+CiAgICAgIDxyZXNvdXJjZSBwYXRoPSJvcmRlciIgaWQ9IkN1cnJlbnQgT3JkZXJzIj4KICAgICAgICAgPGRvYyB4bWw6bGFuZz0iZW4iIHRpdGxlPSJDdXJyZW50IE9yZGVycyIvPgogICAgICAgICA8bWV0aG9kIG5hbWU9IkdFVCIgaWQ9IkdldCBDdXJyZW50IE9yZGVycyI+CiAgICAgICAgICAgIDxkb2MgeG1sOmxhbmc9ImVuIiB0aXRsZT0iR2V0IEN1cnJlbnQgT3JkZXJzIi8+CiAgICAgICAgICAgIDxyZXF1ZXN0PgogICAgICAgICAgICAgICA8cGFyYW0gbmFtZT0iYWNjb3VudCIgZGVmYXVsdD0iMTIzNDU2IiB0eXBlPSJ4czpzdHJpbmciIHJlcXVpcmVkPSJ0cnVlIiBzdHlsZT0icXVlcnkiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIvPgogICAgICAgICAgICA8L3JlcXVlc3Q+CiAgICAgICAgIDwvbWV0aG9kPgogICAgICA8L3Jlc291cmNlPgogICA8L3Jlc291cmNlcz4KPC9hcHBsaWNhdGlvbj4="/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Match request"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Get WADL"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Process request"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
        </wsp:All>
    </wsp:Policy>
</exp:Export>
